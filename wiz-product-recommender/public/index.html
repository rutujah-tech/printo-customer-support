<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WIZ</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Segoe UI',sans-serif;background:linear-gradient(135deg,#667eea,#764ba2);min-height:100vh;padding:20px}
        .container{max-width:600px;margin:0 auto}
        .header{text-align:center;color:#fff;margin-bottom:25px}
        .header h1{font-size:42px}
        .card{background:#fff;border-radius:16px;padding:30px;box-shadow:0 20px 50px rgba(0,0,0,.3)}
        .form-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px}
        .form-group{margin-bottom:12px}
        .full{grid-column:1/-1}
        label{display:block;font-weight:600;margin-bottom:5px;font-size:13px}
        input,select,textarea{width:100%;padding:10px;border:2px solid #e0e0e0;border-radius:8px;font-size:14px}
        input:focus,select:focus,textarea:focus{outline:none;border-color:#667eea}
        textarea{min-height:70px;resize:vertical}
        .photo-box{border:2px dashed #667eea;border-radius:10px;padding:20px;text-align:center;cursor:pointer;background:#f8f9ff}
        .photo-box.active{border-color:#4caf50;background:#f0f9f0}
        .photo-preview img{max-height:120px;border-radius:8px;margin-top:8px}
        .btn{width:100%;padding:14px;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border:none;border-radius:10px;font-size:16px;font-weight:600;cursor:pointer;margin-top:12px}
        .loading{text-align:center;padding:40px}
        .spinner{border:4px solid #f3f3f3;border-top:4px solid #667eea;border-radius:50%;width:45px;height:45px;animation:spin 1s linear infinite;margin:15px auto}
        @keyframes spin{to{transform:rotate(360deg)}}
        .results{display:none}
        .copy{font-size:22px;font-weight:700;text-align:center;margin-bottom:15px;color:#333}
        .style-tag{display:inline-block;background:#667eea;color:#fff;padding:4px 12px;border-radius:15px;font-size:11px;margin-bottom:15px}
        .mockup{text-align:center}
        .mockup img{max-width:100%;max-height:400px;border-radius:12px;box-shadow:0 8px 30px rgba(0,0,0,.2)}
        .back{width:100%;padding:12px;background:#666;color:#fff;border:none;border-radius:8px;cursor:pointer;margin-top:20px}
        @media(max-width:500px){.form-grid{grid-template-columns:1fr}}
    </style>
</head>
<body>
<div class="container">
    <div class="header"><h1>WIZ</h1><p>Personalized Gift Designer</p></div>

    <div class="card" id="formCard">
        <form id="form">
            <div class="form-grid">
                <div class="form-group"><label>Name *</label><input id="name" required placeholder="Priya"></div>
                <div class="form-group"><label>Occasion *</label>
                    <select id="occasion" required><option value="">Select</option><option>Birthday</option><option>Valentine's Day</option><option>Anniversary</option><option>Raksha Bandhan</option><option>Friendship Day</option><option>Mother's Day</option><option>Father's Day</option><option>Wedding</option></select>
                </div>
                <div class="form-group full"><label>Relationship *</label>
                    <select id="rel" required><option value="">Select</option><option>Friend</option><option>Best Friend</option><option>Girlfriend</option><option>Boyfriend</option><option>Wife</option><option>Husband</option><option>Mother</option><option>Father</option><option>Sister</option><option>Brother</option></select>
                </div>
            </div>
            <div class="form-group"><label>What's special? *</label><textarea id="notes" required placeholder="Interests, memories, inside jokes..."></textarea></div>
            <div class="form-group"><label>Photo (Optional)</label>
                <input type="file" id="fileIn" accept="image/*" style="display:none">
                <div class="photo-box" id="photoBox" onclick="document.getElementById('fileIn').click()">ðŸ“· Click to upload</div>
                <div class="photo-preview" id="preview" style="display:none"><img id="previewImg"><br><button type="button" onclick="clearPhoto()" style="margin-top:8px;padding:4px 12px;background:#f44;color:#fff;border:none;border-radius:4px;cursor:pointer">Remove</button></div>
            </div>
            <button type="submit" class="btn">Create Design</button>
        </form>
    </div>

    <div class="card loading" id="loadCard" style="display:none"><div class="spinner"></div><p style="color:#667eea">Creating...</p></div>

    <div class="card results" id="resultCard">
        <div style="text-align:center"><span class="style-tag" id="styleTag"></span></div>
        <div class="copy" id="copyText"></div>
        <div class="mockup" id="mockup"></div>
        <button class="back" onclick="location.reload()">Create Another</button>
    </div>
</div>
<script>
let photo=null;
document.getElementById('fileIn').onchange=e=>{const f=e.target.files[0];if(f){const r=new FileReader();r.onload=ev=>{photo=ev.target.result;document.getElementById('previewImg').src=photo;document.getElementById('preview').style.display='block';document.getElementById('photoBox').classList.add('active')};r.readAsDataURL(f)}};
function clearPhoto(){photo=null;document.getElementById('fileIn').value='';document.getElementById('preview').style.display='none';document.getElementById('photoBox').classList.remove('active')}
document.getElementById('form').onsubmit=async e=>{e.preventDefault();document.getElementById('formCard').style.display='none';document.getElementById('loadCard').style.display='block';
try{const res=await fetch('/api/personalize',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({recipientName:document.getElementById('name').value,occasion:document.getElementById('occasion').value,relationship:document.getElementById('rel').value,specialNotes:document.getElementById('notes').value,photo})});
const d=await res.json();if(d.success){document.getElementById('loadCard').style.display='none';document.getElementById('resultCard').style.display='block';document.getElementById('styleTag').textContent=d.result.style||'Elegant';document.getElementById('copyText').textContent=d.result.copy||'Your design';document.getElementById('mockup').innerHTML=d.result.imageUrl?'<img src="'+d.result.imageUrl+'">':'<div style="padding:40px;background:#f0f0f0;border-radius:12px">Image loading...</div>'}else{alert(d.error||'Error');location.reload()}}catch(err){alert(err.message);location.reload()}};
</script>
</body>
</html>
